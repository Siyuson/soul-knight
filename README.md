# 项目信息：

---

## 项目名：元气骑士
---
### 项目成员：
**莫健文 2051964
陆国林 2051825
肖筱游 2051971
于德洋 2052209**

### 小组贡献比例：
**莫健文 地图(100%) - 骑士角色(100%) - 游戏架构整合(100%) -小地图(100%) 
陆国林 敌人角色(100%) - 敌人AI(100%) - boss(100%) - 道具(100%)
肖筱游 武器(100%) - 音乐(100%) - 雕像(100%) - UI(100%) - 初始界面(100%)
于德洋 素材搜集(100%)**

==Github地址==: ***https://github.com/Siyuson/soul-knight.git***

## 项目进度线：

**【注明】因为开始一段时间小组内没有人习惯使用github和git，所以一开始的合作方式是最朴实的q群面传的方式和线下合作方式，所以对于具体的项目进程时间可能记录不清。**

### 约11-12周

整个小组到各个地方进行cocos2dx的学习，配置环境，搜集游戏贴图素材

### 约 13周

初步完成初始界面，和简单的人物设计，敌人设计

### 14周
***5.31*** 
* 初步生成地图，界面UI完成

***6.3***  
* 加入角色，并且让角色动起来

***6.4***	
* 加入武器，武器能射出子弹

***6.5*** 	
* 调整地图边界，修改角色穿模的bug
* 加入敌人，嵌合敌人与地图生成与修改移动穿模bug
* 加入UI

***6.6*** 
* 完善骑士攻击功能
* 完善敌人攻击功能
* 完善战斗系统：如敌人攻击扣血和骑士攻击扣血的功能
    * 战斗时地图视角锁定
    * 战斗时敌人分批出现

### 15周
***6.9*** 
* 完成道具，加入地图

***6.10***
* 完成雕像，加入地图

***6.12*** 
* 完善地图，加入地图元素（如门，木箱）
* 修改人物移动穿门的bug

### 16周

***6.13*** 
* 完善人物和敌人在木箱穿模的bug

***6.15*** 
* 加入小地图，调整人物所在房间的显示
***6.17*** 
* 加入音乐（背景音、射击音）
    * 完善音乐功能，调节音量

***6.18*** 
* 加入初始界面，与战斗场景整合
* 加入传送系统，整合界面切换

## 项目开发文档：

### 1.	游戏架构设计

**在经过各种资料的学习后，也根据了其他开源代码作为参考，具体可分为以下模块**

#### 一.初始界面

初始界面由图片和按键UI组成
#### 二．安全场景

骑士出生地，以及人物死亡后返回的场景

#### 三.战斗场景

战斗场景主要包括地图、小地图、道具、雕像、骑士、敌人等内容
其中，地图又包括走廊、还有房间。
而房间还内含门、箱子、骑士、敌人等类。

#### 小组分工：

***肖筱游 武器 - 音乐 - 雕像 - UI - 初始界面
莫健文 地图- 骑士角色- 游戏架构整合 -小地图
陆国林 敌人角色 - 敌人AI - boss - 道具
于德洋 素材搜集***

### 2.	实现功能点
**【基础功能】**
1. **游戏界面、暂停及恢复功能、退出功能**
**设计思路**：在初始界面中加入图片，设置坐标、回调函数（切换场景）。

2. **背景音乐、音量控制**
**设计思路**：通过AudioEngine头文件中的函数实现过程中的音乐播放。

1. **武器**
**设计思路**：通过武器的类型和状态选择不同的子弹贴图，并设定不同的伤害以及MP消耗。同时在骑士与敌人贴近时会变为用刀近战造成伤害。

1. **两种敌人**
**设计思路**：根据地图房间的类型，设置不同种类的敌人（图片），敌人随机设置类型，包括近战和远程类型。敌人的移动模式，离骑士的距离大于一定范围时随机移动，在一定方位内向骑士靠近。远程敌人在攻击范围内发射子弹，近战敌人快速靠近骑士，并且当近战敌人与骑士接触2/3秒时（40帧）对骑士造成伤害。

5. **道具**
**设计思路**：贴图+修改骑士数据，使用完后清除。

6. **宝箱**
**设计思路**：根据房间类型生成宝箱，位置为房间中心。一是武器宝箱，对应的房间类型为道具类型，修改房间大小，生成宝箱贴图。当骑士按下确认键时，改变贴图状态，生成武器。二是奖励宝箱，对应的房间类型是普通的战斗房间，当骑士按下确认键时，回复蓝量，宝箱消失。

7. **安全地图与探索地图**
**设计思路**：安全地图功能为完善，只有角色出生的功能。生成角色和传送门，当骑士到达传送门时切换场景。

>探索地图: 个人理解为战斗时的整个大地图。可以先生成一个房间作为起始房间，然后判断该房间的四个方向是否可创建其他房间，（条件为起始房间单向联通一个房间，边界房间单向联通一个房间，其他房间随机挑选一个或多个方向联通其他房间），计算相应生成房间的坐标信息，判断到达生成房间上限的个数后，停止生成房间。房间的初始化包括生成贴图，类型判断是否生成敌人或boss或雕像或宝箱。将每个相邻房间的联通区域生成走廊来链接。

8. **关卡角色死亡**
在战斗场景的update函数中加入判断骑士是否死亡的函数。若骑士HP小于等于零，清空战斗场景，切换回安全场景。

9. **包含两个关卡**
在终点房间处生成传送门，当骑士靠近传送门时，切换至下一战斗场景，并修改场景参数。

####【附加功能】

10. **每次进入到相同关卡时也会有不同的游戏地图、敌人、道具**
**设计思路**：在战斗场景的初始化中，生成房间的函数会随机选择房间坐标来作为起始房间，在方向选择上也是按照随机方式选择，房间的类型也是随机设定的（但保证与起始房间相连的房间一定时普通战斗房间），该功能也就自然实现了。

11. **小地图**
**设计思路**：在独立的一层，随着生成的房间位置，计算出小房间的坐标，并且绘制小矩阵显示在屏幕上，预设颜色值为灰。判断房间类型，如果房间为特殊类型，修改颜色参数，若房间未被探索，则设定为黑；骑士所在的房间设计为白；骑士去过的房间设定为默认灰。

12. **Buff机制**
**设计思路**：房间对应的类型为雕像时，生成雕像。检测碰撞不穿模，因为雕像是静态的所以只需要限制骑士的活动范围就可以了。当骑士按下确认键时，修改骑士参数。需要消耗金币。

13. **金币**
**设计思路**：击杀敌人获得金币，购买buff需要消耗金币。设置作为骑士的成员变量。

14. **特殊地形**
**设计思路**：增加了**木箱**的特殊地形。生成时间为房间生成地板中进行。根据自定义的生成方式，在生成地板后判断该坐标是否需要生成木箱生成。

15. **Boss**
**设计思路**：根据房间的**类型**生成Boss。Boss的初始血量是300，通过与上一次的血量与当下的血量对比来判断boss是否收到攻击，如果收到攻击则会有相应的被攻击特效。boss会根据帧数计时计算自己是需要普通动作还是调用大招。在还未放大招时（每3秒会放一次大招），boss会在可选择的范围内每秒任意进行一次上、下、左、右的行走，每1/3秒进行一次boss与骑士的距离判断，若在近距离攻击的距离内则对骑士进行近距离攻击。在放大招时，boss会在3种大招中（分别是加血，重击，还有瞬移）任意选择一种，完成相应的大招释放。

* ==加血==：如果血量损失少于40则加满，否则在40和98之间任意加血。
* ==重击==：若骑士在重击攻击距离内则boss身边产生扣血圈并挥剑，扣除骑士血量。
* ==瞬移==：若骑士在最大瞬移距离内则boss直接瞬移到骑士身边，否则朝着骑士方向按最大瞬移距离移动，移动过程中有相应的瞬移特效。

1.  **视角转化**
**设计思路**：当人物进入房间战斗时，屏幕的中心坐标位移到骑士的坐标（骑士坐标为屏幕中心），然后骑士坐标位移相同的矢量，移动时只移动骑士的坐标。

### 3.	技术难点
* 一 ==房间的连接==：
生成房间时需要的信息是，四个角的坐标顶点，而这又可以用对顶角的两个坐标来存储，所以在生房间时要注意设置每个房间的**坐标**和**类型**(如普通的战斗房间、boss房间、功能房间)。连接每一个房间，具体做法是，获取每个房间的对顶角坐标，判断相邻两个房间之间的**联通方向**，计算处走廊的**对顶角坐标**，和联通方向生成走廊。在学习后，联通的方向表示方式可以用枚举（enum）表示，定义右上左下分别为0123，在矢量表示时可以将方向带入两个一维数组表示x和y轴方向的值。

* 二 ==人物移动==
想了很久，移动骑士的坐标能局限与一个小区域内的活动。因此，只能将骑士的**坐标固定**为中心，设置骑士的移动速度，根据骑士移速来改变地图坐标来实现移动的**视觉错觉**，对应的也要。在战斗时，琐住地图坐标，移动骑士坐标，实现视角切换。

* 三 ==木箱的碰撞检测==
碰撞检测，由于木箱的生成是**动态**的，所以不好按照静态的方式限制骑士活动方位，实现方式为当骑士与木箱相嵌合时，骑士速度方向**倒置**，与按键所产生的方向相抵消，但是会出现画面震动的现象。对于敌人，设置坐标为原先将要发生碰撞的坐标（矢量位移）。
